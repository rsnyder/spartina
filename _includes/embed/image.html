{%- if include.src -%}
  {%- capture src_final -%}
    {%- include media-url.html src=include.src width=include.width subpath=page.media_subpath -%}
  {%- endcapture -%}
  {%- assign src_final = src_final | strip -%}
  <!-- src_final: {{ src_final }} -->

  {%- assign first_char = src_final | slice: 0, 1 -%}
  {%- if first_char == '/' -%}
    {%- assign src_final = site.url | append: src_final -%}
  {%- endif -%}

  {%- assign qs = "src=" | append: src_final -%}
{%- endif -%}

{%- if include.manifest -%}
{%- assign qs = "manifest=" | append: include.manifest | uri_escape -%}
{%- endif -%}

{%- if include.seq -%}
{%- assign qs = qs | append: "&seq=" | append: include.seq | uri_escape -%}
{%- endif -%}

{%- if include.caption -%}
{%- assign qs = qs | append: "&caption=" | append: include.caption | uri_escape -%}
{%- endif -%}

{%- if include.attribution -%}
{%- assign qs = qs | append: "&attribution=" | append: include.attribution | uri_escape -%}
{%- endif -%}

{%- comment -%} Strict boolean parsing for cover {%- endcomment -%}
{%- assign cover_val = include.cover | downcase | strip -%}
{%- if cover_val == "true" or cover_val == "1" or cover_val == "yes" or cover_val == "on" -%}
{%- assign qs = qs | append: "&cover=1" -%}
{%- endif -%}

{%- comment -%} region: IIIF-like (full | x,y,w,h | pct:x,y,w,h) {%- endcomment -%}
{%- if include.region -%}
{%- assign qs = qs | append: "&region=" | append: include.region | uri_escape -%}
{%- endif -%}

{%- comment -%} rotate: IIIF-like degrees, optional ! prefix for flip (e.g. !90) {%- endcomment -%}
{%- if include.rotate -%}
{%- assign qs = qs | append: "&rotate=" | append: include.rotate | uri_escape -%}
{%- endif -%}

{%- assign class = "embed-image" -%}
{%- if include.class -%}
{%- assign class = class | append: " " | append: include.class -%}
{%- endif -%}

{%- assign qs = qs | replace: '+', '%2B' %}

<iframe id="{{ include.id }}" class="{{ class }}" loading="lazy" title="Juncture image viewer" allow="clipboard-write"
  src="{{ '/assets/components/image.html' | relative_url }}?{{ qs }}" allowfullscreen>
</iframe>